<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ocean Quest - Gamified ToDo</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0EA5E9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Ocean Quest">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiT2NlYW4gUXVlc3QgLSBHYW1pZmllZCBUb0RvIiwic2hvcnRfbmFtZSI6Ik9jZWFuUXVlc3QiLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJ0aGVtZV9jb2xvciI6IiMwRUE1RTkiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiI0Y4RkFGQyIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlNVEk0SWlCb1pXbG5hSFE5SWpFeU9DSWdkbWxsZDBKdmVEMGlNQ0F3SURFME5DQXhORFFpSUdobGJXNXpQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0wzTjJaeUkrUEhKbFkzUWdkMmxrZEdnOUlqRTBOQ0lnYUdWcFoyaDBQU0l4TkRRaUlHWnBiR3c5SWlNd1JVRTFSVGtpTHo0OEwzTjJaejQ9Iiwic2l6ZXMiOiIxNDR4MTQ0IiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ocean: {
                            50: '#f0f9ff',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            900: '#0c4a6e'
                        },
                        sand: {
                            100: '#fef7ed',
                            200: '#fed7aa',
                            300: '#fdba74',
                            400: '#fb923c'
                        },
                        coral: {
                            400: '#ff7f7f',
                            500: '#ef4444'
                        },
                        seafoam: {
                            400: '#20b2aa',
                            500: '#14b8a6'
                        }
                    },
                    fontFamily: {
                        'display': ['Nunito', 'sans-serif'],
                        'body': ['Inter', 'sans-serif']
                    },
                    animation: {
                        'bounce-slow': 'bounce 2s infinite',
                        'pulse-slow': 'pulse 3s infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'treasure-open': 'treasureOpen 1s ease-in-out'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        treasureOpen: {
                            '0%': { transform: 'scale(1) rotate(0deg)' },
                            '50%': { transform: 'scale(1.1) rotate(5deg)' },
                            '100%': { transform: 'scale(1) rotate(0deg)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }
        
        .screen {
            display: none;
            min-height: 100vh;
            position: relative;
        }
        
        .screen.active {
            display: flex;
            flex-direction: column;
        }
        
        .ocean-bg {
            background: linear-gradient(180deg, #0ea5e9 0%, #0284c7 50%, #0c4a6e 100%);
        }
        
        .beach-bg {
            background: linear-gradient(180deg, #87ceeb 0%, #20b2aa 30%, #f5e6d3 100%);
        }
        
        .album-bg {
            background: linear-gradient(135deg, #8b4513 0%, #d2691e  50%, #f4a460 100%);
        }
        
        .treasure-chest {
            width: 120px;
            height: 100px;
            background: linear-gradient(145deg, #8b4513, #d2691e);
            border-radius: 15px 15px 5px 5px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #654321;
        }
        
        .treasure-chest:hover {
            transform: scale(1.05);
        }
        
        .treasure-chest::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 10px;
            right: 10px;
            height: 20px;
            background: linear-gradient(145deg, #ffd700, #ffed4e);
            border-radius: 10px;
            border: 2px solid #b8860b;
        }
        
        .treasure-chest::after {
            content: '🔒';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            z-index: 2;
        }
        
        .treasure-chest.unlocked::after {
            content: '✨';
            animation: pulse 1s infinite;
        }
        
        .rarity-common {
            border: 2px solid #94a3b8;
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
        }
        
        .rarity-rare {
            border: 2px solid #3b82f6;
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
        }
        
        .rarity-epic {
            border: 2px solid #a855f7;
            background: linear-gradient(135deg, #f3e8ff, #e9d5ff);
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.4);
        }
        
        .collected {
            opacity: 1;
            transform: scale(1);
        }
        
        .not-collected {
            opacity: 0.3;
            filter: grayscale(100%);
        }
        
        .todo-item {
            transition: all 0.3s ease;
        }
        
        .todo-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }
        
        .floating-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .navigation-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        
        @media (max-width: 380px) {
            .treasure-chest {
                width: 100px;
                height: 80px;
            }
            
            .collection-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Opening Screen -->
    <div id="opening-screen" class="screen active ocean-bg">
        <div class="flex-1 flex flex-col justify-center items-center p-6 text-white">
            <!-- Ocean waves background decoration -->
            <div class="absolute inset-0 opacity-20">
                <div class="absolute bottom-0 w-full">
                    <svg viewBox="0 0 1200 120" xmlns="http://www.w3.org/2000/svg" class="w-full h-32">
                        <path d="M0,96L40,90.7C80,85,160,75,240,80C320,85,400,107,480,122.7C560,139,640,149,720,144C800,139,880,117,960,106.7C1040,96,1120,96,1160,96L1200,96L1200,120L1160,120C1120,120,1040,120,960,120C880,120,800,120,720,120C640,120,560,120,480,120C400,120,320,120,240,120C160,120,80,120,40,120L0,120Z" fill="rgba(255,255,255,0.1)"/>
                    </svg>
                </div>
            </div>
            
            <div class="text-center z-10">
                <div class="mb-8">
                    <i class="fas fa-anchor text-8xl text-yellow-300 animate-float"></i>
                </div>
                
                <h1 class="font-display text-5xl font-bold mb-4 text-shadow">Ocean Quest</h1>
                <p class="text-xl mb-8 text-blue-100">Complete your daily tasks and discover treasures from the deep!</p>
                
                <div class="bg-white/90 backdrop-blur rounded-2xl p-6 mx-4 max-w-sm">
                    <h2 class="font-display text-2xl font-semibold text-ocean-700 mb-4">Welcome, Explorer!</h2>
                    <p class="text-gray-600 mb-4">Enter your name to begin your ocean adventure</p>
                    
                    <input 
                        type="text" 
                        id="username-input" 
                        placeholder="Your name..."
                        class="w-full p-4 border-2 border-ocean-200 rounded-xl text-lg font-medium focus:border-ocean-500 focus:outline-none transition-colors"
                        maxlength="20"
                    >
                    
                    <button 
                        onclick="startGame()"
                        class="w-full mt-4 bg-ocean-500 hover:bg-ocean-600 text-white font-semibold py-4 px-6 rounded-xl transition-colors text-lg shadow-lg"
                    >
                        <i class="fas fa-anchor mr-2"></i>
                        Start Adventure
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ToDo List Screen -->
    <div id="todo-screen" class="screen ocean-bg">
        <div class="flex-1 pb-20">
            <!-- Header -->
            <div class="bg-white/95 backdrop-blur p-4 shadow-lg">
                <h1 class="font-display text-2xl font-bold text-ocean-700 text-center">
                    <span id="username-display"></span>'s ToDo List
                </h1>
                <div class="flex justify-center mt-2">
                    <div class="bg-ocean-100 px-4 py-2 rounded-full">
                        <span id="todo-count" class="text-ocean-700 font-semibold">0 tasks</span>
                    </div>
                </div>
            </div>
            
            <!-- Add ToDo Section -->
            <div class="p-4">
                <div class="bg-white rounded-2xl p-4 shadow-lg mb-4">
                    <h3 class="font-display text-lg font-semibold text-gray-700 mb-3">
                        <i class="fas fa-plus-circle text-ocean-500 mr-2"></i>
                        Add New Task
                    </h3>
                    
                    <div class="flex gap-3">
                        <input 
                            type="text" 
                            id="todo-input" 
                            placeholder="What needs to be done?"
                            class="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-ocean-500 focus:outline-none transition-colors"
                            maxlength="100"
                        >
                        <button 
                            onclick="addTodo()"
                            class="bg-ocean-500 hover:bg-ocean-600 text-white px-6 py-3 rounded-xl transition-colors shadow-md"
                        >
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                
                <!-- ToDo List -->
                <div class="space-y-3" id="todo-list">
                    <!-- ToDo items will be dynamically added here -->
                </div>
                
                <!-- Status Message -->
                <div class="mt-6 p-4 bg-white/90 backdrop-blur rounded-2xl text-center">
                    <div id="status-message" class="text-lg font-semibold text-gray-600">
                        First complete all ToDo's to get the key! 🗝️
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Navigation Bar -->
        <div class="navigation-bar">
            <div class="flex justify-around py-3">
                <button onclick="showScreen('todo-screen')" class="flex flex-col items-center p-2 text-ocean-600">
                    <i class="fas fa-list text-xl mb-1"></i>
                    <span class="text-xs font-medium">Tasks</span>
                </button>
                <button onclick="showScreen('treasure-screen')" class="flex flex-col items-center p-2 text-gray-400">
                    <i class="fas fa-treasure-chest text-xl mb-1"></i>
                    <span class="text-xs font-medium">Treasure</span>
                </button>
                <button onclick="showScreen('collection-screen')" class="flex flex-col items-center p-2 text-gray-400">
                    <i class="fas fa-book text-xl mb-1"></i>
                    <span class="text-xs font-medium">Collection</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Treasure Chest Screen -->
    <div id="treasure-screen" class="screen beach-bg">
        <div class="flex-1 pb-20">
            <!-- Header -->
            <div class="bg-white/95 backdrop-blur p-4 shadow-lg">
                <h1 class="font-display text-2xl font-bold text-ocean-700 text-center">
                    <i class="fas fa-map-marker-alt mr-2"></i>
                    Treasure Beach
                </h1>
            </div>
            
            <!-- Beach Scene -->
            <div class="flex-1 flex flex-col justify-center items-center p-6 relative">
                <!-- Beach decorations -->
                <div class="absolute inset-x-0 bottom-0 h-32 bg-sand-200 rounded-t-full opacity-60"></div>
                
                <!-- Palm trees decoration -->
                <div class="absolute top-10 left-4">
                    <i class="fas fa-tree text-4xl text-green-600 opacity-40 transform rotate-12"></i>
                </div>
                <div class="absolute top-20 right-6">
                    <i class="fas fa-tree text-5xl text-green-700 opacity-30 transform -rotate-6"></i>
                </div>
                
                <!-- Treasure Chest -->
                <div class="text-center z-10">
                    <div class="mb-6">
                        <div id="treasure-chest" class="treasure-chest mx-auto animate-float" onclick="openTreasure()">
                        </div>
                    </div>
                    
                    <h2 class="font-display text-3xl font-bold text-white mb-4 text-shadow">
                        Mysterious Treasure Chest
                    </h2>
                    
                    <p class="text-white/90 text-lg mb-6 max-w-sm">
                        Complete all your daily tasks to unlock the treasure and discover what lies within!
                    </p>
                    
                    <!-- Error/Success Messages -->
                    <div id="treasure-message" class="bg-white/90 backdrop-blur rounded-xl p-4 mx-4 hidden">
                        <p class="text-gray-700 font-semibold"></p>
                    </div>
                    
                    <!-- Discovered Item -->
                    <div id="discovered-item" class="bg-white/95 backdrop-blur rounded-2xl p-6 mx-4 mt-6 hidden">
                        <h3 class="font-display text-xl font-bold text-ocean-700 mb-3">
                            <i class="fas fa-gift mr-2"></i>
                            You discovered:
                        </h3>
                        <div id="item-display" class="text-center">
                            <!-- Item will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Navigation Bar -->
        <div class="navigation-bar">
            <div class="flex justify-around py-3">
                <button onclick="showScreen('todo-screen')" class="flex flex-col items-center p-2 text-gray-400">
                    <i class="fas fa-list text-xl mb-1"></i>
                    <span class="text-xs font-medium">Tasks</span>
                </button>
                <button onclick="showScreen('treasure-screen')" class="flex flex-col items-center p-2 text-ocean-600">
                    <i class="fas fa-treasure-chest text-xl mb-1"></i>
                    <span class="text-xs font-medium">Treasure</span>
                </button>
                <button onclick="showScreen('collection-screen')" class="flex flex-col items-center p-2 text-gray-400">
                    <i class="fas fa-book text-xl mb-1"></i>
                    <span class="text-xs font-medium">Collection</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Collection Album Screen -->
    <div id="collection-screen" class="screen album-bg">
        <div class="flex-1 pb-20">
            <!-- Header -->
            <div class="bg-white/95 backdrop-blur p-4 shadow-lg">
                <h1 class="font-display text-2xl font-bold text-ocean-700 text-center">
                    <i class="fas fa-book-open mr-2"></i>
                    Collection Album
                </h1>
                <div class="flex justify-center mt-2">
                    <div class="bg-yellow-100 px-4 py-2 rounded-full">
                        <span id="collection-count" class="text-yellow-800 font-semibold">0/28 collected</span>
                    </div>
                </div>
            </div>
            
            <!-- Collection Grid -->
            <div class="p-4">
                <div class="bg-white/90 backdrop-blur rounded-2xl p-4 shadow-lg">
                    <div id="collection-grid" class="grid grid-cols-4 gap-3 collection-grid">
                        <!-- Collection items will be dynamically generated here -->
                    </div>
                </div>
                
                <!-- Legend -->
                <div class="mt-4 bg-white/90 backdrop-blur rounded-xl p-4">
                    <h3 class="font-display text-lg font-semibold text-gray-700 mb-3">Rarity Guide</h3>
                    <div class="space-y-2">
                        <div class="flex items-center gap-3">
                            <div class="w-4 h-4 rounded rarity-common"></div>
                            <span class="text-sm text-gray-600">Common (3x drop rate)</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-4 h-4 rounded rarity-rare"></div>
                            <span class="text-sm text-gray-600">Rare (2x drop rate)</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-4 h-4 rounded rarity-epic"></div>
                            <span class="text-sm text-gray-600">Epic (1x drop rate)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Navigation Bar -->
        <div class="navigation-bar">
            <div class="flex justify-around py-3">
                <button onclick="showScreen('todo-screen')" class="flex flex-col items-center p-2 text-gray-400">
                    <i class="fas fa-list text-xl mb-1"></i>
                    <span class="text-xs font-medium">Tasks</span>
                </button>
                <button onclick="showScreen('treasure-screen')" class="flex flex-col items-center p-2 text-gray-400">
                    <i class="fas fa-treasure-chest text-xl mb-1"></i>
                    <span class="text-xs font-medium">Treasure</span>
                </button>
                <button onclick="showScreen('collection-screen')" class="flex flex-col items-center p-2 text-ocean-600">
                    <i class="fas fa-book text-xl mb-1"></i>
                    <span class="text-xs font-medium">Collection</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Final Completion Screen -->
    <div id="final-screen" class="screen ocean-bg">
        <div class="flex-1 flex flex-col justify-center items-center p-6 text-white">
            <!-- Celebration effects -->
            <div class="absolute inset-0 overflow-hidden">
                <div class="absolute top-1/4 left-1/4 text-yellow-300 text-4xl animate-bounce">✨</div>
                <div class="absolute top-1/3 right-1/4 text-yellow-300 text-3xl animate-bounce" style="animation-delay: 0.5s;">⭐</div>
                <div class="absolute bottom-1/3 left-1/3 text-yellow-300 text-5xl animate-bounce" style="animation-delay: 1s;">🎉</div>
                <div class="absolute top-1/2 right-1/3 text-yellow-300 text-3xl animate-bounce" style="animation-delay: 1.5s;">✨</div>
            </div>
            
            <div class="text-center z-10">
                <!-- Scroll background -->
                <div class="bg-amber-50 border-4 border-amber-800 rounded-lg p-8 mx-4 shadow-2xl transform rotate-1 relative">
                    <div class="absolute -top-2 -left-2 w-6 h-6 bg-amber-800 rounded-full"></div>
                    <div class="absolute -top-2 -right-2 w-6 h-6 bg-amber-800 rounded-full"></div>
                    <div class="absolute -bottom-2 -left-2 w-6 h-6 bg-amber-800 rounded-full"></div>
                    <div class="absolute -bottom-2 -right-2 w-6 h-6 bg-amber-800 rounded-full"></div>
                    
                    <div class="text-amber-900">
                        <h1 class="font-display text-4xl font-bold mb-4">🏆 Hurray! 🏆</h1>
                        <h2 class="font-display text-2xl font-semibold mb-4">You did it!</h2>
                        <p class="text-lg mb-6">You've collected every treasure from the ocean depths. You're a true Ocean Quest Master!</p>
                        
                        <div class="text-6xl mb-6">🐙🐠🦈🦞🐚</div>
                        
                        <button 
                            onclick="resetGame()"
                            class="bg-ocean-500 hover:bg-ocean-600 text-white font-bold py-4 px-8 rounded-xl transition-colors text-lg shadow-lg"
                        >
                            <i class="fas fa-redo mr-2"></i>
                            Start New Adventure
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game Data Structure
        const ITEMS = [
            {id: 1, name: "Shrimp", rarity: "common", emoji: "🦐"},
            {id: 2, name: "Prawn", rarity: "rare", emoji: "🦐"},
            {id: 3, name: "Mackerel", rarity: "rare", emoji: "🐟"},
            {id: 4, name: "Red Snapper", rarity: "rare", emoji: "🐟"},
            {id: 5, name: "Salmon", rarity: "rare", emoji: "🐟"},
            {id: 6, name: "Clown Fish", rarity: "rare", emoji: "🐠"},
            {id: 7, name: "Koi", rarity: "rare", emoji: "🐠"},
            {id: 8, name: "Bob", rarity: "rare", emoji: "🐠"},
            {id: 9, name: "Puffer", rarity: "rare", emoji: "🐡"},
            {id: 10, name: "Eel", rarity: "epic", emoji: "🐍"},
            {id: 11, name: "Lantern Fish", rarity: "rare", emoji: "🐟"},
            {id: 12, name: "Sardine", rarity: "rare", emoji: "🐟"},
            {id: 13, name: "Ray", rarity: "epic", emoji: "🐟"},
            {id: 14, name: "Sea Horse", rarity: "rare", emoji: "🐴"},
            {id: 15, name: "Blob Fish", rarity: "rare", emoji: "🐟"},
            {id: 16, name: "Lobster", rarity: "rare", emoji: "🦞"},
            {id: 17, name: "Starfish", rarity: "common", emoji: "⭐"},
            {id: 18, name: "Octopus", rarity: "rare", emoji: "🐙"},
            {id: 19, name: "Crab", rarity: "rare", emoji: "🦀"},
            {id: 20, name: "Scampi", rarity: "rare", emoji: "🦐"},
            {id: 21, name: "Long Nosed Shell", rarity: "common", emoji: "🐚"},
            {id: 22, name: "Conch", rarity: "common", emoji: "🐚"},
            {id: 23, name: "Axolotl", rarity: "rare", emoji: "🦎"},
            {id: 24, name: "Swordfish", rarity: "epic", emoji: "🗡️"},
            {id: 25, name: "Can", rarity: "common", emoji: "🥫"},
            {id: 26, name: "Bone", rarity: "common", emoji: "🦴"},
            {id: 27, name: "Fishbone", rarity: "common", emoji: "🦴"},
            {id: 28, name: "Worm", rarity: "common", emoji: "🪱"}
        ];

        // Game State
        let gameState = {
            username: '',
            todos: [],
            collectedItems: [],
            treasureOpenedToday: false,
            lastResetDate: new Date().toDateString()
        };

        // Initialize Game
        (function initGame() {
            loadGameState();
            
            // Check for daily reset
            const today = new Date().toDateString();
            if (gameState.lastResetDate !== today) {
                dailyReset();
            }
            
            // Show appropriate screen
            if (!gameState.username) {
                showScreen('opening-screen');
            } else {
                document.getElementById('username-display').textContent = gameState.username;
                showScreen('todo-screen');
                updateTodoDisplay();
                updateCollectionDisplay();
                updateTreasureChest();
            }
            
            // Check for completion
            if (gameState.collectedItems.length === ITEMS.length) {
                showScreen('final-screen');
            }
        })();

        // Screen Navigation
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            
            // Update navigation indicators
            document.querySelectorAll('.navigation-bar button').forEach(btn => {
                btn.classList.remove('text-ocean-600');
                btn.classList.add('text-gray-400');
            });
        }

        // Start Game Function
        function startGame() {
            const username = document.getElementById('username-input').value.trim();
            if (!username) {
                alert('Please enter your name to continue!');
                return;
            }
            
            gameState.username = username;
            document.getElementById('username-display').textContent = username;
            saveGameState();
            
            showScreen('todo-screen');
            updateTodoDisplay();
            updateCollectionDisplay();
        }

        // ToDo Functions
        function addTodo() {
            const input = document.getElementById('todo-input');
            const text = input.value.trim();
            
            if (!text) {
                alert('Please enter a task!');
                return;
            }
            
            const todo = {
                id: Date.now(),
                text: text,
                completed: false,
                createdAt: new Date().toISOString()
            };
            
            gameState.todos.push(todo);
            input.value = '';
            
            updateTodoDisplay();
            updateTreasureChest();
            saveGameState();
        }

        function toggleTodo(id) {
            const todo = gameState.todos.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                updateTodoDisplay();
                updateTreasureChest();
                saveGameState();
            }
        }

        function deleteTodo(id) {
            gameState.todos = gameState.todos.filter(t => t.id !== id);
            updateTodoDisplay();
            updateTreasureChest();
            saveGameState();
        }

        function updateTodoDisplay() {
            const todoList = document.getElementById('todo-list');
            const todoCount = document.getElementById('todo-count');
            const statusMessage = document.getElementById('status-message');
            
            // Update count
            const completedCount = gameState.todos.filter(t => t.completed).length;
            const totalCount = gameState.todos.length;
            todoCount.textContent = `${completedCount}/${totalCount} tasks completed`;
            
            // Update status message
            const allCompleted = totalCount > 0 && completedCount === totalCount;
            if (totalCount === 0) {
                statusMessage.innerHTML = 'Add your first task to get started! 📝';
                statusMessage.className = 'text-lg font-semibold text-gray-600';
            } else if (allCompleted) {
                statusMessage.innerHTML = 'Perfect! You\'ve got the key! 🗝️✨';
                statusMessage.className = 'text-lg font-semibold text-green-600';
            } else {
                statusMessage.innerHTML = `Complete ${totalCount - completedCount} more task${totalCount - completedCount !== 1 ? 's' : ''} to get the key! 🗝️`;
                statusMessage.className = 'text-lg font-semibold text-gray-600';
            }
            
            // Update todo list
            todoList.innerHTML = '';
            gameState.todos.forEach(todo => {
                const todoElement = document.createElement('div');
                todoElement.className = `todo-item bg-white rounded-xl p-4 shadow-md flex items-center gap-3 ${todo.completed ? 'completed' : ''}`;
                
                todoElement.innerHTML = `
                    <input 
                        type="checkbox" 
                        ${todo.completed ? 'checked' : ''} 
                        onchange="toggleTodo(${todo.id})"
                        class="w-5 h-5 text-ocean-500 rounded focus:ring-ocean-300"
                    >
                    <span class="flex-1 text-gray-700 ${todo.completed ? 'line-through opacity-60' : ''}">${todo.text}</span>
                    <button 
                        onclick="deleteTodo(${todo.id})"
                        class="text-red-500 hover:text-red-700 p-2 rounded-lg hover:bg-red-50 transition-colors"
                    >
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                todoList.appendChild(todoElement);
            });
        }

        // Treasure Functions
        function updateTreasureChest() {
            const chest = document.getElementById('treasure-chest');
            const allCompleted = gameState.todos.length > 0 && gameState.todos.every(t => t.completed);
            
            if (allCompleted && !gameState.treasureOpenedToday) {
                chest.classList.add('unlocked');
                chest.style.cursor = 'pointer';
            } else {
                chest.classList.remove('unlocked');
                chest.style.cursor = gameState.treasureOpenedToday ? 'not-allowed' : 'pointer';
            }
        }

        function openTreasure() {
            const messageDiv = document.getElementById('treasure-message');
            const messageText = messageDiv.querySelector('p');
            
            // Check if already opened today
            if (gameState.treasureOpenedToday) {
                showTreasureMessage('Come back tomorrow for a new treasure! 🌅', 'warning');
                return;
            }
            
            // Check if all todos are completed
            const allCompleted = gameState.todos.length > 0 && gameState.todos.every(t => t.completed);
            if (!allCompleted) {
                showTreasureMessage('You need the key. Complete all ToDos! 🗝️', 'error');
                return;
            }
            
            // Open treasure and get random item
            const randomItem = getRandomItem();
            if (randomItem && !gameState.collectedItems.includes(randomItem.id)) {
                gameState.collectedItems.push(randomItem.id);
                gameState.treasureOpenedToday = true;
                
                // Animate chest opening
                const chest = document.getElementById('treasure-chest');
                chest.style.animation = 'treasureOpen 1s ease-in-out';
                
                setTimeout(() => {
                    displayDiscoveredItem(randomItem);
                    updateCollectionDisplay();
                    saveGameState();
                    
                    // Check if collection is complete
                    if (gameState.collectedItems.length === ITEMS.length) {
                        setTimeout(() => {
                            showScreen('final-screen');
                        }, 3000);
                    }
                }, 1000);
            } else {
                showTreasureMessage('The treasure chest is empty! Try again tomorrow. 📦', 'info');
            }
        }

        function showTreasureMessage(message, type) {
            const messageDiv = document.getElementById('treasure-message');
            const messageText = messageDiv.querySelector('p');
            
            messageText.textContent = message;
            messageDiv.className = `bg-white/90 backdrop-blur rounded-xl p-4 mx-4 ${
                type === 'error' ? 'border-l-4 border-red-500' :
                type === 'warning' ? 'border-l-4 border-yellow-500' :
                type === 'success' ? 'border-l-4 border-green-500' :
                'border-l-4 border-blue-500'
            }`;
            messageDiv.classList.remove('hidden');
            
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 3000);
        }

        function getRandomItem() {
            // Create weighted array based on rarity
            const weightedItems = [];
            ITEMS.forEach(item => {
                if (!gameState.collectedItems.includes(item.id)) {
                    const weight = item.rarity === 'common' ? 3 : 
                                  item.rarity === 'rare' ? 2 : 1;
                    for (let i = 0; i < weight; i++) {
                        weightedItems.push(item);
                    }
                }
            });
            
            if (weightedItems.length === 0) return null;
            
            const randomIndex = Math.floor(Math.random() * weightedItems.length);
            return weightedItems[randomIndex];
        }

        function displayDiscoveredItem(item) {
            const discoveredDiv = document.getElementById('discovered-item');
            const itemDisplay = document.getElementById('item-display');
            
            itemDisplay.innerHTML = `
                <div class="rarity-${item.rarity} rounded-xl p-4 mx-auto max-w-xs">
                    <div class="text-4xl mb-2">${item.emoji}</div>
                    <h4 class="font-display text-xl font-bold text-gray-800">${item.name}</h4>
                    <p class="text-sm text-gray-600 capitalize">${item.rarity}</p>
                </div>
            `;
            
            discoveredDiv.classList.remove('hidden');
        }

        // Collection Functions
        function updateCollectionDisplay() {
            const collectionGrid = document.getElementById('collection-grid');
            const collectionCount = document.getElementById('collection-count');
            
            // Update count
            collectionCount.textContent = `${gameState.collectedItems.length}/28 collected`;
            
            // Update grid
            collectionGrid.innerHTML = '';
            ITEMS.forEach(item => {
                const isCollected = gameState.collectedItems.includes(item.id);
                
                const itemElement = document.createElement('div');
                itemElement.className = `rarity-${item.rarity} rounded-lg p-3 text-center aspect-square flex flex-col justify-center ${
                    isCollected ? 'collected' : 'not-collected'
                }`;
                
                itemElement.innerHTML = `
                    <div class="text-2xl mb-1">${item.emoji}</div>
                    <div class="text-xs font-semibold text-gray-700">${item.name}</div>
                `;
                
                collectionGrid.appendChild(itemElement);
            });
        }

        // Daily Reset Function
        function dailyReset() {
            gameState.todos = [];
            gameState.treasureOpenedToday = false;
            gameState.lastResetDate = new Date().toDateString();
            saveGameState();
        }

        // Game Reset Function
        function resetGame() {
            localStorage.removeItem('oceanQuestGameState');
            location.reload();
        }

        // Storage Functions
        function saveGameState() {
            localStorage.setItem('oceanQuestGameState', JSON.stringify(gameState));
        }

        function loadGameState() {
            const saved = localStorage.getItem('oceanQuestGameState');
            if (saved) {
                gameState = { ...gameState, ...JSON.parse(saved) };
            }
        }

        // Keyboard Event Handlers
        document.getElementById('username-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                startGame();
            }
        });

        document.getElementById('todo-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addTodo();
            }
        });

        // Schedule daily reset at midnight
        function scheduleNextReset() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(now.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            const timeUntilMidnight = tomorrow.getTime() - now.getTime();
            
            setTimeout(() => {
                dailyReset();
                updateTodoDisplay();
                updateTreasureChest();
                scheduleNextReset(); // Schedule next reset
            }, timeUntilMidnight);
        }

        // Start the reset scheduler
        scheduleNextReset();

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4gewogIGV2ZW50LndhaXRVbnRpbChjYWNoZXMub3Blbignb2NlYW4tcXVlc3QtdjEnKS50aGVuKGNhY2hlID0+IHsKICAgIHJldHVybiBjYWNoZS5hZGRBbGwoWycvJ10pOwogIH0pKTsKfSk7CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgZXZlbnQgPT4gewogIGV2ZW50LnJlc3BvbmRXaXRoKAogICAgY2FjaGVzLm1hdGNoKGV2ZW50LnJlcXVlc3QpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICByZXR1cm4gcmVzcG9uc2UgfHwgZmV0Y2goZXZlbnQucmVxdWVzdCk7CiAgICB9KQogICk7Cn0pOw==')
            .then(() => console.log('Service Worker registered'))
            .catch(err => console.log('Service Worker registration failed'));
        }
    </script>
</body>
</html>